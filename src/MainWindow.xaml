<Window x:Class="UGTLive.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:UGTLive"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        mc:Ignorable="d"
        Title="Transparent Screen Capture" 
        Height="{Binding InitialHeight}" Width="{Binding InitialWidth}"
        WindowStyle="None"
        ResizeMode="CanResizeWithGrip"
        AllowsTransparency="True"
        Background="Transparent"
        Topmost="True"
        KeyboardNavigation.TabNavigation="None"
        Icon="/media/Icon1.ico">
    <WindowChrome.WindowChrome>
        <WindowChrome ResizeBorderThickness="15" CaptionHeight="10" GlassFrameThickness="0" UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>
      
    
    <Grid Background="Transparent">
        <!-- UI elements to hide during capture - HIDDEN DURING SCREENSHOT -->
        <!-- Note: Grid needs a background (even 1% opacity) for WebView2 hit testing to work in transparent windows -->
        <!-- OverlayContent is outside MainBorder so it remains visible when MainBorder is hidden -->
        <!-- Top margin will be dynamically adjusted based on header height -->
        <Grid Name="OverlayContent" Margin="0,50,0,0" IsHitTestVisible="True" Background="#01000000">
            <!-- WebView2 for text overlays - with margins to avoid blocking resize borders -->
            <wv2:WebView2 x:Name="textOverlayWebView" 
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          DefaultBackgroundColor="Transparent"
                          Margin="15,0,15,15"
                          IsHitTestVisible="True"
                          Panel.ZIndex="100"/>
        </Grid>
        
        <!-- Main border for resizing - can be hidden via Hide button -->
        <!-- Higher Z-index ensures buttons are clickable above the overlay -->
        <Border Name="MainBorder" BorderThickness="1" BorderBrush="#CFFF0000" Background="Transparent" Panel.ZIndex="200">
            <Grid>
                <!-- Top control bar with auto-sizing grid -->
                <Grid x:Name="TopControlGrid" VerticalAlignment="Top">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="10"/>
                        <!-- Resize strip -->
                        <RowDefinition Height="Auto"/>
                        <!-- Header content (can wrap) -->
                    </Grid.RowDefinitions>
                    
                    <!-- Top resize strip - 10px height -->
                    <Border Grid.Row="0" x:Name="TopResizeStrip" Background="#50FF0000" Cursor="SizeNS"
                           WindowChrome.IsHitTestVisibleInChrome="False"/>
                    
                    <!-- Header with wrappable content -->
                    <Border Grid.Row="1" x:Name="HeaderBorder" Background="#CC202020" BorderThickness="1"
                            MouseLeftButtonDown="Header_MouseLeftButtonDown"
                            WindowChrome.IsHitTestVisibleInChrome="True"
                            SizeChanged="HeaderBorder_SizeChanged">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Wrappable controls -->
                            <WrapPanel Grid.Column="0" Orientation="Horizontal" HorizontalAlignment="Left" 
                                      Margin="5,5,5,5" WindowChrome.IsHitTestVisibleInChrome="True">
                                <!-- Primary Buttons -->
                                <Button x:Name="hideButton" Content="Hide" Padding="8,3" Margin="2"
                                        Background="#FF5F5F5F" Foreground="White" BorderThickness="1" BorderBrush="White"
                                        Click="HideButton_Click" WindowChrome.IsHitTestVisibleInChrome="True"/>
                                        
                                <Button x:Name="toggleButton" Content="Start" Padding="8,3" Margin="2"
                                        Background="#FF14B414" Foreground="White" BorderThickness="1" BorderBrush="White"
                                        Click="OnStartButtonToggleClicked" WindowChrome.IsHitTestVisibleInChrome="True"/>
                                
                                <Button x:Name="snapshotButton" Content="S" Padding="8,3" Margin="2"
                                        Background="#FF5F5F5F" Foreground="White" BorderThickness="1" BorderBrush="White"
                                        Click="SnapshotButton_Click" WindowChrome.IsHitTestVisibleInChrome="True"/>
                                
                                <!-- Window Toggle Buttons -->
                                <Button x:Name="monitorButton" Content="Monitor" Padding="8,3" Margin="2"
                                        Background="#FF4569B0" Foreground="White" BorderThickness="1" BorderBrush="White"
                                        Click="MonitorButton_Click" WindowChrome.IsHitTestVisibleInChrome="True"/>
                                        
                                <Button x:Name="chatBoxButton" Content="ChatBox" Padding="8,3" Margin="2"
                                        Background="#FF45B069" Foreground="White" BorderThickness="1" BorderBrush="White"
                                        Click="ChatBoxButton_Click" WindowChrome.IsHitTestVisibleInChrome="True"/>
                                        
                                <Button x:Name="listenButton" Content="Listen" Padding="8,3" Margin="2"
                                        Background="#FF4577B0" Foreground="White" BorderThickness="1" BorderBrush="White"
                                        Click="ListenButton_Click" WindowChrome.IsHitTestVisibleInChrome="True"/>
                                        
                                <Button x:Name="logButton" Content="Log" Padding="8,3" Margin="2"
                                        Background="#FF9945B0" Foreground="White" BorderThickness="1" BorderBrush="White"
                                        Click="LogButton_Click" WindowChrome.IsHitTestVisibleInChrome="True"/>
                                        
                                <Button x:Name="settingsButton" Content="Settings" Padding="8,3" Margin="2"
                                        Background="#FFB07D45" Foreground="White" BorderThickness="1" BorderBrush="White"
                                        Click="SettingsButton_Click" WindowChrome.IsHitTestVisibleInChrome="True"/>
                                
                                <Button x:Name="exportButton" Content="View in browser" Padding="8,3" Margin="2"
                                        Background="#FF5F8FD4" Foreground="White" BorderThickness="1" BorderBrush="White"
                                        Click="ExportButton_Click" WindowChrome.IsHitTestVisibleInChrome="True"/>
                                
                                <!-- Separator -->
                                <Rectangle Width="1" Fill="#60FFFFFF" Margin="5,2" VerticalAlignment="Stretch" Height="20"/>
                                
                                <!-- Overlay Controls -->
                                <TextBlock Text="Overlay:" Foreground="White" VerticalAlignment="Center" Margin="5,0,5,0"
                                          WindowChrome.IsHitTestVisibleInChrome="True"/>
                                <RadioButton x:Name="overlayHideRadio" Content="Hide" Foreground="White" VerticalAlignment="Center" 
                                             Margin="0,0,8,0" GroupName="MainOverlayMode" 
                                             Checked="OverlayRadioButton_Checked" Tag="Hide"
                                             WindowChrome.IsHitTestVisibleInChrome="True"/>
                                <RadioButton x:Name="overlaySourceRadio" Content="Source" Foreground="White" VerticalAlignment="Center" 
                                             Margin="0,0,8,0" GroupName="MainOverlayMode"
                                             Checked="OverlayRadioButton_Checked" Tag="Source"
                                             WindowChrome.IsHitTestVisibleInChrome="True"/>
                                <RadioButton x:Name="overlayTranslatedRadio" Content="Translated" Foreground="White" VerticalAlignment="Center" 
                                             Margin="0,0,8,0" GroupName="MainOverlayMode" 
                                             Checked="OverlayRadioButton_Checked" Tag="Translated"
                                             WindowChrome.IsHitTestVisibleInChrome="True"/>
                                
                                <!-- Separator -->
                                <Rectangle Width="1" Fill="#60FFFFFF" Margin="5,2" VerticalAlignment="Stretch" Height="20"/>
                                
                                <!-- Play All Audio Button -->
                                <Button x:Name="playAllAudioButton" Content="ðŸ”Š All" Padding="8,3" Margin="2"
                                        Background="#FF5F5F5F" Foreground="White" BorderThickness="1" BorderBrush="White"
                                        Click="PlayAllAudioButton_Click" WindowChrome.IsHitTestVisibleInChrome="True"
                                        ToolTip="Play all audio files in order"
                                        MinWidth="80" Width="80"/>
                                
                                <!-- Separator -->
                                <Rectangle Width="1" Fill="#60FFFFFF" Margin="5,2" VerticalAlignment="Stretch" Height="20"/>
                                
                                <!-- Passthrough Checkbox -->
                                <CheckBox x:Name="mousePassthroughCheckBox" Content="Passthrough" Foreground="White" 
                                         VerticalAlignment="Center" Margin="5,0,5,0"
                                         Checked="MousePassthroughCheckBox_Changed" Unchecked="MousePassthroughCheckBox_Changed"
                                         WindowChrome.IsHitTestVisibleInChrome="True"/>
                                
                                <!-- Separator -->
                                <Rectangle Width="1" Fill="#60FFFFFF" Margin="5,2" VerticalAlignment="Stretch" Height="20"/>
                                
                                <!-- Status Display in Header -->
								<Border x:Name="translationStatusBorder"
                                        Background="#DD404040"
                                        Padding="8,3"
                                        CornerRadius="3"
                                        BorderThickness="1"
                                        BorderBrush="#666666"
                                        Visibility="Visible"
                                        VerticalAlignment="Center"
                                        Margin="5,0">
									<TextBlock x:Name="translationStatusLabel"
                                              Foreground="#FFDDDDDD"
                                              FontSize="12"
                                              FontWeight="SemiBold"
                                              Text="Stopped"
                                              VerticalAlignment="Center"
                                              Width="280"
                                              TextAlignment="Center"
                                              TextTrimming="CharacterEllipsis"/>
								</Border>
                            </WrapPanel>
                            
                            <!-- Close Button -->
                            <Button Grid.Column="1" Content="X" Width="30" Height="30" 
                                    HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,5,5,5"
                                    Background="#CCE63232" Foreground="White" FontWeight="Bold"
                                    Click="CloseButton_Click" WindowChrome.IsHitTestVisibleInChrome="True"/>
                        </Grid>
                    </Border>
                </Grid>
                
                <!-- Resize grip indicators -->
                <Rectangle Width="24" Height="24" Fill="#80808080"
                          HorizontalAlignment="Right" VerticalAlignment="Bottom"
                          Cursor="SizeNWSE"/>
                
                <!-- Resize borders - visual indicators only -->
                <Border x:Name="ResizeBorder" BorderBrush="#8FFF0000" BorderThickness="7" Background="Transparent" IsHitTestVisible="False"/>
            </Grid>
        </Border>
    </Grid>
</Window>